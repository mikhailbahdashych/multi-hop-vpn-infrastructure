#!/bin/bash
# Entry node iptables: OpenVPN (tun0) -> WireGuard (wg0)
set -euo pipefail

# Flush existing rules
iptables -F FORWARD
iptables -t nat -F POSTROUTING

# NAT from OpenVPN clients to WireGuard tunnel
iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o wg0 -j MASQUERADE

# Forward between tun0 (OpenVPN) and wg0 (WireGuard)
iptables -A FORWARD -i tun0 -o wg0 -j ACCEPT
iptables -A FORWARD -i wg0 -o tun0 -m state --state RELATED,ESTABLISHED -j ACCEPT
